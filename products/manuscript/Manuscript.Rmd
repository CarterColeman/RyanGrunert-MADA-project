---
title: "Prevalence of *Haemoproteus plataleae* in American White Ibis from Southern Florida"
subtitle: ""
author: Ryan Grunert
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: article
output:
  bookdown::word_document2: 
    toc: false
    number_sections: true
  bookdown::html_document2: 
    toc: false
bibliography: ../references.bib
csl: ../apa.csl
---
```{r}
#Loading required packages #for data processing
library(here) #to set paths
library(tidyverse) #all required data manipulation packages
library(xlsx) #to read in excel spreadsheets
library(janitor) #To assist in cleaning up dates and tidy data
library(lubridate) #To extract times from raw data
```


# Introduction 

## General Background Information
The data this analysis concerns is American White Ibis (*Eudocimus albus*) blood parasite data that was collected from 2010-2017. The parasite the data focuses on is the protozoan *Haemoproteus*, which causes a chronic blood infection in White Ibises and many other birds. *Haemoproteus* is a vector-borne disease, it is transmitted by *Culicoides* biting midges when they feed on the birds and causes long-lasting parasitemia. Adult healthy birds tolerate haemosporidian infections well, but young birds and birds outside their normal range that are naive to the pathogen are more likely to develop clinical disease. Haemosporidian infections usually cause long-lasting chronic infections in natural hosts, and can cause reduced reproductive success, host fitness, and increased stress and disease susceptibility.

The purpose of this analysis is to determine whether the presence of *Haemoproteus* was increasing over time in Ibis in southern Florida, and if so, determine any demographic trends among the Ibis or temporal or spatial trends among the system at large. Here we investigate whether age, sex, sampling site, capture season, date of capture, body condition, and/or mass of captured Ibis make significant differences on the overall presence of *Haemoproteus* in the birds. 

# Methods

## Data Collection

The data was collected by various undergraduate and graduate students of Dr. Sonia Hernandez and Dr. Michael Yabsley at the University of Georgia. Wild American White Ibis were captured during multiple sampling seasons between 2010-2017 in various urban and natural habitat sites from southern Florida. Data was recorded in excel sheets that included information about the sampling sites (habitat type, location, etc.) and various characteristics about the captured Ibis (weight, sex, age, etc.). Ibis were bled and lab diagnostics were performed at the Southeastern Cooperative Wildlife Disease Study (SCWDS) at UGA in order to determine the presence of *Haemoproteus* parasitemia, and if possible, amount of parasitemia in the blood.

## Data Cleaning

The data was organized in 2 excel sheets; one containing all the lab diagnostic data concerning the sampled Ibis and the other containing all the descriptive, demographic, and geographic data about the sampled Ibis. Both excel files were combined while removing uninformative and duplicate variables in both. Variables of importance were standardized once both datasheets were combined. If sampling season was not recorded but sampling date was for an Ibis, season was determined from the date and added. I dichotomized the recorded amount of *Haemoproteus* parasitemia to either "1" (presence) or "0" (absence) by whether or not the Ibis had a parasitemia value of above zero. Locations that did not have presence of *Haemoproteus* and had less than 5 observations with little demographic information were removed from analysis.

## Data Analysis

Univariate relationships between the presence of *Haemoproteus* parasitemia and each predictor were assessed using logistic regression treating *Haemoproteus* parasitemia presence as a categorical outcome. Multivariate classification was also performed, determination of variables to include was performed by sequential forward floating selection. In addition, a Least Absolute Shrinkage and Selection Operator (LASSO) model, a decision tree, and a random forest model were all conducted with *Haemoproteus* parasitemia presence as the outcome variable. The goal of all models was maximization of accuracy and roc_auc on test data using a 10 fold cross-validation (80/20 split, 5 times repeated).

## Study Population

During all of the sampling seasons, 668 Ibis were sampled. Among those sampled, 355 Ibis had a positive *Haemoproteus* parasitemia value. 20 Ibis were removed from the analysis because they did not have a positive *Haemoproteus* parasitemia value and the site from which they were captured had less than or equal to 5 sampled Ibis and had no presence of infected Ibis. 


## Exploratory Analysis



### Tables

To start the exploratory analysis, we're going to create some quick tables to get an idea of the metrics for some of the columns of interest.

```{r}
IbisC %>%
  count(Sex, wt = HaeParasitPA)
```

Looking at presence/absence data for haemoproteus parasitemia, there were about double the number of female ibises with active infection compared to the males. 78 of the ibises sampled were negative for haemoproteus infection.  

```{r}
IbisC %>%
  count(Age, wt = HaeParasitPA)
```

Here we can see that there was about 2.7 times more adults sampled with active infection than juvenile ibises. 59 of the sampled ibises with active infection either couldn't be aged or age was not recorded.

```{r}
IbisC %>%
  count(Age, Sex, wt = HaeParasitPA)
```

Combining age and sex, we can see that adult females had the highest number of active infections. Categories with missing numbers are prevalent.

```{r}
IbisC %>%
  count(Site, wt = HaeParasitPA)
```
Looking at site, SWA, ICP, and DRP were the sites with the highest number of sampled ibises with active infection.

```{r}
IbisC %>%
  count(Season, wt = HaeParasitPA)
```
Looking at season sampled, Spring 2016 had the highest number of sampled ibises with active infection, followed by Summer 2013, Spring 2017, and Spring 2014.

```{r}
IbisC %>%
  count(BodyCondScore, Age, wt = HaeParasitPA)
```
Looking at body condition score, the majority of the birds sampled with active infection were an ideal weight or underweight. This lets us know that an active infection didn't affect body condition too harshly on these birds.

### Figures

Now we can move onto creating some figures for the data to see any patterns visually.

Figure 1: Haemoproteus parasitemia from sampled infected Ibises from 2010-2017 by habitat type
```{r}
ExpFigure1 <-ggplot(IbisC) +
  geom_point(aes(x = Date, y = HaeParasitLog10, color = HabType)) +
  ggtitle("Haemoproteus parasitemia from sampled infected Ibises from 2010-2017 by habitat type") +
  xlab("Date") +
  ylab("Haemoproteus Parasitemia (Log base 10)") +
  scale_color_discrete("Habitat Type", na.translate = F) +
  theme(plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10))

Figure_file1 <- here("results", "Figures", "ExpFigure1.png")
ggsave(filename = Figure_file1,plot = ExpFigure1)

ExpFigure1
```

This scatterplot graphs the sample dates chronologically against the parasitemia measured from the sampled ibis on a transformed log base 10 scale. Habitat type is depicted by color of the dots. Overall, there is a general narrowing of the data over time with a slight negative correlation. There isn't a clear difference between natural and urban habitat types when it comes to amount of parasitemia. 

Figure 2: Haemoproteus parasitemia from adult and juvenile sampled Ibises
```{r}
ExpFigure2 <- IbisC %>%
  drop_na(Age) %>%
  ggplot() +
  geom_violin(aes(x = Age, y = HaeParasit)) +
  ggtitle("Haemoproteus parasitemia from adult and juvenile sampled Ibises") +
  xlab("Age") +
  ylab("Haemoproteus Parasitemia") +
  scale_y_continuous(limits = c(0, 0.1)) +
  theme(plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10))

Figure_file2 <- here("results", "Figures", "ExpFigure2.png")
ggsave(filename = Figure_file2, plot = ExpFigure2)

ExpFigure2
```

This violin plot graphs the haemoproteus parasitemia distribution for the adult and juvenile Ibises sampled. The majority of the parasitemia values are on the lower end for both adults and juveniles. The distribution for adults reaches higher than juveniles. The overall structure for the adult distribution is higher and skinnier, while juveniles have more of their parasitemias lower in value. 

Figure 3: Haemoproteus parasitemia from sampled Ibises by sex
```{r}
ExpFigure3 <- IbisC %>%
  drop_na(Sex) %>%
  ggplot() +
  geom_boxplot(aes(x = Sex, y = HaeParasit)) +
  scale_y_continuous(limits = c(0, 0.5)) +
  ggtitle("Haemoproteus parasitemia from sampled Ibises by sex") +
  xlab("Sex") +
  ylab("Haemoproteus Parasitemia") +
  theme(plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10))

Figure_file3 <- here("results", "Figures", "ExpFigure3.png")
ggsave(filename = Figure_file3, plot = ExpFigure3)

ExpFigure3
```

The haemoproteus parasitemia distributions between sexes is extremely similar. The median value for males is slightly higher than females. The majority of the measured parasitemias are between 0.0 and 0.1. 

Figure 4: Haemoproteus parasitemia by total female and male Ibis mass
```{r}
ExpFigure4 <- IbisC %>%
  drop_na(BirdMassG, Sex) %>%
  ggplot() +
  geom_point(aes(x = BirdMassG, y = HaeParasitLog10, color = Sex)) +
  theme(axis.text.x = element_text(angle = 90)) +
  scale_x_continuous(limits = c(130, 1240)) +
  ggtitle("Haemoproteus parasitemia by total female and male Ibis mass") +
  xlab("Total mass of Ibis (g)") +
  ylab("Haemoproteus Parasitemia (Log base 10)") +
  theme(plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10))

Figure_file4 <- here("results", "Figures", "ExpFigure4.png")
ggsave(filename = Figure_file4, plot = ExpFigure4)

ExpFigure4
```

Looking at the plot, male birds seem to weigh more than females. However, when comparing the parasitemia between females and males, there isn't a clear difference between the two.

Figure 5: Haemoproteus parasitemia by female and male Ibis mass and body condition score
```{r}
ExpFigure5 <- IbisC %>%
  drop_na(BirdMassG, BodyCondScore, Sex) %>%
  ggplot() +
  geom_point(aes(x = BirdMassG, y = HaeParasitLog10, color = BodyCondScore)) +
  facet_wrap(~ Sex) +
  ggtitle("Haemoproteus parasitemia by female and male Ibis mass and body condition score") +
  xlab("Total mass of Ibis (g)") +
  ylab("Haemoproteus Parasitemia (Log base 10)") +
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10)) +
  scale_x_continuous(limits = c(130, 1240)) +
  scale_color_discrete("Body Condition", na.translate = F)

Figure_file5 <- here("results", "Figures", "ExpFigure5.png")
ggsave(filename = Figure_file5, plot = ExpFigure5)

ExpFigure5
```

Looking at this plot, there are more underweight female ibises with higher parasitemias compared to males. This could be due to the higher number of sampled females though. 

Figure 6: Haemoproteus parasitemia by sample site and habitat type
```{r}
ExpFigure6 <- IbisC %>%
  drop_na(HabType, Site) %>%
  ggplot() +
  geom_point(aes(x = Site, y = log10(HaeParasit), color = HabType)) +
  theme(axis.text.x = element_text(angle = 90),
        plot.title = element_text(hjust = 0.5, size = 10),
        axis.title.x = element_text(size = 10),
        axis.title.y = element_text(size = 10),
        legend.title = element_text(size = 10)) +
  ggtitle("Haemoproteus parasitemia by sample site and habitat type") +
  xlab("Sample Site") +
  ylab("Haemoproteus Parasitemia (Log base 10)") +
  scale_color_discrete("Habitat Type", na.translate = F) 

Figure_file6 <- here("results", "Figures", "ExpFigure6.png")
ggsave(filename = Figure_file6, plot = ExpFigure6)

ExpFigure6
```

Looking at this plot broadly, it seems that the sites with a natural habitat have a slightly lower average parasitemia than the sites with an urban habitat. 

Overall, there are no huge patterns or clear differences between covariates and variates so far. Statistical analyses may pick up on any significant differences later on, but I will return to the exploratory analysis as I continue with the project. I will also be meeting with those involved with the project to discuss as well.

## Statistical Analyses

### Presence/Absence Haemoproteus Parasitemia Data

This section details the results of a preliminary statistical analysis on the Haemoproteus parasitemia data just looking at the presence and absence data, as opposed to the amount of parasitemia per sampled bird.

The following models were setup and tested through a 10-fold cross-validation. The training/testing data proportions were 80/20. 10 folds were taken on 80% of the observations, and the results are depicted here. I am currently struggling with applying the models generated by CV to the testing data.

```{r}
data_locationPA1 <- here::here("results", "Tables", "Model1MetricsPA.Rda")
table1 <- readRDS(data_locationPA1)
table1
```
This univariate classification GLM looked at the effect of habitat type on the presence of Haemoproteus in infected birds. The results were unsatisfactory.

```{r}
data_locationPA2 <- here::here("results", "Tables", "Model2MetricsPA.Rda")
table2 <- readRDS(data_locationPA2)
table2
```
This univariate classification GLM looked at the effect of sex of the Ibis on the presence of Haemoproteus in infected birds. The results were unsatisfactory.
 
```{r}
data_locationPA3 <- here::here("results", "Tables", "Model3MetricsPA.Rda")
table3 <- readRDS(data_locationPA3)
table3
```
This univariate classification GLM looked at the effect of age of the Ibis on the presence of Haemoproteus in infected birds. The results were unsatisfactory.

```{r}
data_locationPA4 <- here::here("results", "Tables", "Model4MetricsPA.Rda")
table4 <- readRDS(data_locationPA4)
table4
```
This univariate classification GLM looked at the effect of sampling site on the presence of Haemoproteus in infected birds. The results were unsatisfactory.

```{r}
data_locationPA5 <- here::here("results", "Tables", "Model5MetricsPA.Rda")
table5 <- readRDS(data_locationPA5)
table5
```
This univariate classification GLM looked at the effect of sampling date on the presence of Haemoproteus in infected birds. The results were unsatisfactory.

```{r}
data_locationPA6 <- here::here("results", "Tables", "Model6MetricsPA.Rda")
table6 <- readRDS(data_locationPA6)
table6
```
This univariate classification GLM looked at the effect of sampling season on the presence of Haemoproteus in infected birds. The results were unsatisfactory, however, these results were better than the other univariate models so far.

```{r}
data_locationPA7 <- here::here("results", "Tables", "Model7MetricsPA.Rda")
table7 <- readRDS(data_locationPA7)
table7
```
This multivariate classification GLM looked at the effect of age and sex on the presence of Haemoproteus in infected birds. The results were unsatisfactory, this model scored about the same as the previous univariate models for age and sex.

```{r}
data_locationPA8 <- here::here("results", "Tables", "Model8MetricsPA.Rda")
table8 <- readRDS(data_locationPA8)
table8
```
This multivariate classification GLM looked at the effect of sampling date and sampling season on the presence of Haemoproteus in infected birds. The results here had the highest performance of all the other models so far. One way to interpret this model would be that as the sampling effort continued from 2010-2017, the passage of time and season had a significant effect on the presence of Haemoproteus in Ibis. However, the performance of this model isn't high enough to successfully conclude with that explanation.

### Regression Models for the Amount of Haemoproteus Parasitemia

This section details the results of a preliminary statistical analysis on the Haemoproteus parasitemia data looking at the amount of measured parasitemia per sampled bird (on a logarithm base 10 scale), as opposed to presence/absence data.

The following models were setup and tested through a 10-fold cross-validation. The training/testing data proportions were 80/20. 10 folds were taken on 80% of the observations, and the results are depicted here. I am currently struggling with applying the models generated by CV to the testing data.

#### Random Forest Model

The following are the results from a random forest model run on all the predictors against the Haemoproteus parasitemia (log base 10) data. The missing data values were imputed by K nearest neighbors. The model was run on all 10 folds from the training dataset.
```{r}
data_locationRF <- here::here("results", "Tables", "RandomForestMetrics.Rda")
table9 <- readRDS(data_locationRF)
table9
```
This random forest model looked at the effect of all predictors on the amount of Haemoproteus in infected birds. The results were unsatisfactory, this model had a relatively high RMSE and low R squared value.

#### Linear Regression Model

The following are the results from a linear regression model run on habitat type against the Haemoproteus parasitemia (log base 10) data. 

```{r}
data_locationLM1 <- here::here("results", "Tables", "LinMetrics1.Rda")
table10 <- readRDS(data_locationLM1)
table10
```
This linear regression model looked at the effect of habitat type on the amount of Haemoproteus in infected birds. The results were unsatisfactory, the RMSE is high and the R squared value is very low.

#### Conclusions so far

This concludes the statistical analysis for part 3. Overall, the models did not perform well, especially those looking at the amount of Haemoproteus in infected birds. The presence/absence data has more potential for conclusions to be made based on generated models. The next steps would be to fine-tune the classification models for the presence/absence data and create a random forest model.

Current problems that have arose in this process include imputing missing values to run models (as there is a large amount of missing data in this dataset), and visualizing the tidymodels results on a graph. 















